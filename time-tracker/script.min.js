(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){var t={nextId:1,tasksById:{},timeslotsById:{},now:Date.now(),ui:{confirm:{ok:null,okText:"Yes",cancel:null,cancelText:"No",text:null,always:null}}},e={taskList:function(){return n.keyedObjectToArray(this.tasksById,function(t){return t.id})},timeslots:function(){return n.keyedObjectToArray(this.timeslotsById,function(t){return t.begin})},timeslotsByTask:function(){var t={},e=!0,n=!1,i=void 0;try{for(var r,o=this.timeslots[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;null!=s.taskId&&(null==t[s.taskId]&&(t[s.taskId]=[]),t[s.taskId].push(s))}}catch(t){n=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw i}}return t},tasks:function(){return this.taskList.map(this.getComputedTask)},rootTasks:function(){return this.tasks.filter(function(t){return null==t.parentId})},subTasks:function(){var t={},e=!0,n=!1,i=void 0;try{for(var r,o=this.taskList[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var s=r.value;null!=s.parentId&&(null==t[s.parentId]&&(t[s.parentId]=[]),t[s.parentId].push(s))}}catch(t){n=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw i}}return t},activeTask:function(){return this.tasks.find(function(t){return t.isActive})},ancestors:function(){var t={},e={},n=!0,i=!1,r=void 0;try{for(var o,s=this.taskList[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value;t[a.id]=this.getAncestors(a,e)}}catch(t){i=!0,r=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw r}}return t},totalDuration:function(){var t=this;return this.rootTasks.reduce(function(e,n){return e+t.getTaskDuration(n)},0)},absoluteTotalDuration:function(){return Math.abs(this.totalDuration)}},n=function(){function t(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.showDays,i=void 0===n||n,r=e.showHours,o=void 0===r||r,s=e.showMinutes,a=void 0===s||s,u=e.showSeconds,l=void 0===u||u,c=t<0,d=Math.abs(t),f=[{label:"d",sec:86400,show:i},{label:"h",sec:3600,show:o},{label:"m",sec:60,show:a},{label:"s",sec:1,show:l}].filter(function(t){return t.show}),h="",m=f[f.length-1],v=!0,p=!1,k=void 0;try{for(var y,g=f[Symbol.iterator]();!(v=(y=g.next()).done);v=!0){var T=y.value,I=Math.floor(d/T.sec);d%=T.sec,(I>0||!h&&T===m)&&(h+=I+T.label)}}catch(t){p=!0,k=t}finally{try{!v&&g.return&&g.return()}finally{if(p)throw k}}return(c?"-":"")+h}function e(t,e){window.localStorage&&window.localStorage.setItem(t,JSON.stringify(e))}function i(t){if(!window.localStorage)return null;try{var e=window.localStorage.getItem(t);return JSON.parse(e)}catch(t){console.error(t)}}function r(t,e){if("function"==typeof t){var n=[].slice.apply(arguments).slice(2);t.apply(e,n)}}function o(t,e){return s(t,"0",e)}function s(t,e,n){for(var i=""+t;i.length<n;)i=e+i;return i}function a(t){var e=/^([012]?[0-9]):?([0-5][0-9])$/,n=e.exec(t);if(null==n||3!==n.length)return t&&console.warn("Invalid time string, should match RegExp "+e+' but got "'+t+'"'),null;var i=parseInt(n[1],10),r=parseInt(n[2],10),o=new Date;return o.setHours(i),o.setMinutes(r),o.setSeconds(0,0),o.getTime()}function u(t,e){var n=Object.keys(t).map(function(e){return t[e]});return"function"==typeof e?d(n,e):n}function l(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.showZero,r=void 0===i||i,o=e.showSeconds,s=void 0===o||o,a=e.showMinutes,u=void 0===a||a,l=e.showHours,c=void 0===l||l,d=e.showDays,f=void 0===d||d,h=Math.round(t),m=n.secondsToDisplayDuration(h,{showDays:f,showSeconds:s,showMinutes:u,showHours:c});return!r&&/^-?0[dhms]$/.test(m)?null:m}function c(t,e){if("number"!=typeof t)return null!=t&&console.warn("Timestamp should be a number, but got a "+(void 0===t?"undefined":_typeof(t))),e;var i=new Date(t),r=i.getHours(),o=i.getMinutes();return n.zeropad(r,2)+":"+n.zeropad(o,2)}function d(t,e){return t.sort(function(t,n){var i=e(t),r=e(n);return i>r?1:r>i?-1:0})}return{secondsToDisplayDuration:t,saveToStorage:e,getFromStorage:i,timeToTimestamp:a,sort:d,zeropad:o,pad:s,keyedObjectToArray:u,formatDuration:l,formatTimestamp:c,runIfFn:r}}(),i={getComputedTask:function(t){var e=this.timeslotsByTask[t.id]||[];return Object.assign({},t,{duration:this.getTaskDuration(t),timeslots:e.map(this.getComputedTimeslot),subTasks:this.getSubTasks(t).map(this.getComputedTask),isActive:e.some(function(t){return null!=t.begin&&null==t.end}),_source:t})},getSubTasks:function(t){var e=[],n=!0,i=!1,r=void 0;try{for(var o,s=this.taskList[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value;a.parentId===t.id&&e.push(a)}}catch(t){i=!0,r=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw r}}return e},getComputedTimeslot:function(t){return Object.assign({},t,{isActive:null!=t.begin&&null==t.end,end:t.end||this.now,duration:this.getTimeslotDuration(t),_source:t})},getAncestors:function(t,e){var n=this.tasksById[t.parentId];if(null==n)return[];if(null!=e[t.id])return e[t.id];if(null!=n){var i=[n].concat(_toConsumableArray(this.getAncestors(n,e)));return e[t.id]=i,i}},isAncestor:function(t,e){return this.ancestors[e.id].indexOf(t)>-1},save:function(){var e={};for(var i in t)0!==i.indexOf("_")&&0!==i.indexOf("$")&&"now"!==i&&"ui"!==i&&(e[i]=t[i]);n.saveToStorage("time-tracker",e)},inputTask:function(t){this.addTask({name:t.value}),t.value=""},addTask:function(t){var e=this,n=t.name,i=t.parentId,r=this.createTask(n,i);this.updateTask(r.id,function(){return r},function(){return e.startTask(r.id)})},createTask:function(t,e){var n=this.nextId++,i={id:n,parentId:e,name:t};return Vue.set(this.tasksById,n,i),i},moveTask:function(t){var e=t.taskId,n=t.parentId;if(null!=e&&null!=n&&e!==n){var i=this.tasksById[e],r=this.tasksById[n];if(null==i||null==r||i.parentId===r.id)return;if(this.isAncestor(i,r))return;this.updateTask(e,function(t){return Vue.set(t,"parentId",n),t})}},changeTimeslotBegin:function(t){this.changeTimeslotTimestamp(t,"begin")},changeTimeslotEnd:function(t){this.changeTimeslotTimestamp(t,"end")},changeTimeslotTimestamp:function(t,e){var n=t.timeslotId,i=t.timestamp;this.updateTimeslot(n,function(t){return Vue.set(t,e,i),t})},onDrop:function(t){var e=t.dataTransfer.getData("taskId");e&&this.updateTask(e,function(t){return Vue.delete(t,"parentId"),t})},onDragOver:function(t){t.preventDefault()},updateTask:function(t,e,n){e(this.tasksById[t]),"function"==typeof n&&n()},updateTimeslot:function(t,e,n){var i=this.timeslotsById[t];if(null==i)return void console.warn("No timeslot found with id "+t);var r=e(i);Vue.set(this.timeslotsById,r.id,r),"function"==typeof n&&n()},startTask:function(t){var e=this,n=this.activeTask;n&&n.id!==t&&this.stopTask(n.id),this.updateTask(t,function(n){return e.createTimeslot(t),n})},stopTask:function(t){var e=this;this.updateTask(t,function(n){if(null!=n){var i=e.timeslotsByTask[t]||[],r=i.filter(function(t){return null!=t.begin&&null==t.end}),o=Date.now(),s=!0,a=!1,u=void 0;try{for(var l,c=r[Symbol.iterator]();!(s=(l=c.next()).done);s=!0){var d=l.value;Vue.set(d,"end",o)}}catch(t){a=!0,u=t}finally{try{!s&&c.return&&c.return()}finally{if(a)throw u}}return n}})},removeTask:function(t){Vue.delete(this.tasksById,t);var e=this.subTasks[t];if(Array.isArray(e)){var n=!0,i=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value;this.removeTask(a.id)}}catch(t){i=!0,r=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw r}}}var u=this.timeslotsByTask[t];if(Array.isArray(u)){var l=!0,c=!1,d=void 0;try{for(var f,h=u[Symbol.iterator]();!(l=(f=h.next()).done);l=!0){var m=f.value;this.removeTimeslot(m.id)}}catch(t){c=!0,d=t}finally{try{!l&&h.return&&h.return()}finally{if(c)throw d}}}0===this.tasks.length&&(this.nextId=1)},askToRemoveTask:function(t){var e=this,n=this.tasksById[t];if(null!=n){var i=n.name||"<no name>";this.showConfirmation("Delete "+i+"?",function(){return e.removeTask(t)},this.clearConfirmation)}},showConfirmation:function(e,n,i,r,o,s){Vue.set(t.ui.confirm,"text",e),Vue.set(t.ui.confirm,"ok",n),Vue.set(t.ui.confirm,"always",i),Vue.set(t.ui.confirm,"cancel",r),o&&Vue.set(t.ui.confirm,"okText",o),s&&Vue.set(t.ui.confirm,"cancelText",s)},clearConfirmation:function(){t.ui.confirm.ok=null,t.ui.confirm.cancel=null,t.ui.confirm.always=null,t.ui.confirm.text=null},createTimeslot:function(t){var e=this.nextId++;this.setNow();var n={id:e,taskId:t,begin:this.now};return Vue.set(this.timeslotsById,e,n),n},removeTimeslot:function(t){Vue.delete(this.timeslotsById,t)},askToRemoveTimeslot:function(t){var e=this,i=this.timeslotsById[t];if(null!=i){var r=this.tasksById[i.taskId],o=r&&r.name||"<no task>",s=this.getComputedTimeslot(i),a=n.formatTimestamp(s.begin,"???"),u=n.formatTimestamp(s.end,"???");this.showConfirmation("Remove "+a+" - "+u+" of "+o+"?",function(){return e.removeTimeslot(t)},this.clearConfirmation)}},timeslotToNewTask:function(t){var e=this.timeslotsById[t];if(null!=e){var n=this.createTask(null,e.taskId);this.timeslotToTask({id:t,taskId:n.id})}},timeslotToTask:function(t){var e=t.id,n=t.taskId;null!=this.tasksById[n]&&this.updateTimeslot(e,function(t){return Vue.set(t,"taskId",n),t})},clearAll:function(){var t=this,e=function(){t.nextId=1;for(var e in t.tasksById)Vue.delete(t.tasksById,e);for(var n in t.timeslotsById)Vue.delete(t.timeslotsById,n)};this.showConfirmation("Remove all tasks?",e,this.clearConfirmation)},resetTask:function(t){var e=this;this.updateTask(t,function(n){return e.clearTimeslots(t),n})},clearTimeslots:function(t){var e=this.timeslotsByTask[t];if(Array.isArray(e)){var n=!0,i=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value;Vue.delete(this.timeslotsById,a.id)}}catch(t){i=!0,r=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw r}}}},getTimeslotDuration:function(t){if(null==t||null==t.begin)return 0;var e=t.end||this.now;return Math.round((e-t.begin)/1e3)},getTaskDuration:function(t){var e=this,n=this.timeslotsByTask[t.id]||[],i=n.reduce(function(t,n){return t+e.getTimeslotDuration(n)},0),r=this.subTasks[t.id],o=0;return Array.isArray(r)&&(o=r.reduce(function(t,n){return t+e.getTaskDuration(n)},0)),i+o},updateDocumentTitle:function(){if(null==this.activeTask||null==this.activeTask.duration)document.title!==this.documentTitle&&(document.title=this.documentTitle);else{var t=n.formatDuration(this.activeTask.duration,{showZero:!1,showSeconds:Math.abs(this.activeTask.duration)<60});if(null!=t){var e=this.activeTask.name||"";document.title=t+" - "+e}}},formatDuration:n.formatDuration,setNow:function(){this.now=Date.now()},skipSave:function(t){var e=this;this.dontSave=1,t(),Vue.nextTick(function(){return delete e.dontSave})},mainLoop:function(t){var e=this;this.skipSave(this.setNow),this.updateDocumentTitle(),setTimeout(function(){return e.mainLoop(t)},t)}};Vue.directive("focus",{inserted:function(t){t.focus()}}),Vue.component("task",{props:["task"],template:"#task",mounted:function(){this.$el.addEventListener("dragstart",this.onDragStart),this.$el.addEventListener("dragend",this.onDragEnd),this.$el.addEventListener("dragover",this.onDragOver),this.$el.addEventListener("dragleave",this.onDragLeave),this.$el.addEventListener("drop",this.onDrop),document.addEventListener("click",this.onClick),this.task.name||(this.editName=!0)},beforeDestroy:function(){this.$el.removeEventListener("dragstart",this.onDragStart),this.$el.removeEventListener("dragend",this.onDragEnd),this.$el.removeEventListener("dragover",this.onDragOver),this.$el.removeEventListener("drop",this.onDrop),this.$el.removeEventListener("dragleave",this.onDragLeave),document.removeEventListener("click",this.onClick)},data:function(){return{dropzone:!1,dragging:!1,editName:!1,collapsed:!1}},methods:{formatTimestamp:n.formatTimestamp,formatDuration:n.formatDuration,onDragStart:function(t){t.stopPropagation(),t.dataTransfer.dropEffect="move",t.dataTransfer.setData("taskId",this.task.id),t.dataTransfer.setData("parentId",this.task.parentId),this.dragging=!0},onDragEnd:function(t){t.preventDefault(),this.dragging=!1},onDragOver:function(t){t.preventDefault(),t.stopPropagation(),this.dropzone=!0},onDragLeave:function(t){t.preventDefault(),this.dropzone=!1},onDrop:function(t){t.preventDefault(),t.stopPropagation(),this.dropzone=!1;var e=parseInt(t.dataTransfer.getData("taskId"),10);isNaN(e)||this.$emit("move-task",{taskId:e,parentId:this.task.id})},onClick:function(t){if(null!=t.target&&null!=t.target.parentNode){t.target.closest(".task")!==this.$el&&this.task.name&&(this.editName=!1)}},toggleEdit:function(){this.task.name&&(this.editName=!this.editName)}}}),Vue.component("timeslot",{props:["timeslot","task"],template:"#timeslot",mounted:function(){document.addEventListener("click",this.onClick)},beforeDestroy:function(){document.removeEventListener("click",this.onClick)},data:function(){return{begin:null,end:null}},methods:{formatTimestamp:n.formatTimestamp,formatDuration:n.formatDuration,changeTimeslotBegin:function(t){var e=this.timeslot.id,i=n.timeToTimestamp(t);this.$emit("change-timeslot-begin",{timeslotId:e,timestamp:i}),this.begin=null},changeTimeslotEnd:function(t){var e=this.timeslot.id,i=n.timeToTimestamp(t);this.$emit("change-timeslot-end",{timeslotId:e,timestamp:i}),this.end=null},onClick:function(t){if(null!=t.target&&null!=t.target.parentNode){t.target.closest(".timeslot")!==this.$el&&(this.begin=null,this.end=null)}}}}),Vue.component("confirm-dialog",{template:"#confirm-dialog",props:["config"],methods:{ok:function(){n.runIfFn(this.config.ok),n.runIfFn(this.config.always)},cancel:function(){n.runIfFn(this.config.cancel),n.runIfFn(this.config.always)},onClick:function(t){t.preventDefault(),t.stopPropagation(),t.target===this.$el&&(n.runIfFn(this.cancel),n.runIfFn(this.always))}},mounted:function(){this.$el.addEventListener("click",this.onClick)},beforeDestroy:function(){this.$el.removeEventListener("click",this.onClick)}});new Vue({el:"#time-tracker",data:t,methods:i,computed:e,beforeCreate:function(){var e=n.getFromStorage("time-tracker");null!=e&&Object.assign(t,e)},mounted:function(){var t=this;this.documentTitle=document.title,Vue.nextTick(function(){return t.mainLoop(1e3)}),this.$el.addEventListener("drop",this.onDrop),this.$el.addEventListener("dragover",this.onDragOver)},beforeDestroy:function(){this.$el.removeEventListener("drop",this.onDrop),this.$el.removeEventListener("dragover",this.onDragOver)},updated:function(){this.dontSave||this.save()}})}();
},{}]},{},[1]);
